// @daz4126/helium@0.30.0 downloaded from https://ga.jspm.io/npm:@daz4126/helium@0.30.0/helium.js

const e=e=>{try{return Function(`return(${e})`)()}catch{return e}};const t={form:"submit",input:"input",textarea:"input",select:"change"};const n=e=>t[e.tagName.toLowerCase()]||"click";const s=(e,t)=>{let n;return(...s)=>(clearTimeout(n),n=setTimeout(e,t,...s))};let r=null;window.helium=async function(){let t;const o=Symbol("all");const c=/^(@|:|data-he)/;const a=(e,...t)=>{const n=e.split(/[.:]/)[0];if(n===":"||n==="")return false;for(const e of t)if(n===`@${e}`||n===`data-he-${e}`)return true;return false};const i=document.querySelector("[\\@helium]")||document.querySelector("[data-helium]")||document.body;r||(r={observer:null,bindings:new Map,refs:new Map,listeners:new WeakMap,processed:new WeakSet,parentKeys:new WeakMap,fnCache:new Map,proxyCache:new WeakMap});const l=e=>document.querySelector(e);const u=e=>Object.assign(document.createElement("template"),{innerHTML:e.trim()}).content.firstChild;const d=(e,t,n,s)=>{const o=[];t.forEach(((t,c)=>{const a=t instanceof Node?t:r.refs.get(t.trim())||l(t.trim());if(a){const t=s?s(e):e;const r=u(t);n[c]?a[n[c]=="replace"?"replaceWith":n[c]](r):a.innerHTML=t;o.push(n[c]?r:a)}else w[t]=e}));return o};const h=(e,t,n={},s={})=>{n.loading&&(n.target=d(n.loading,n.target,n.action)||n.target);const r=s instanceof FormData,o=document.querySelector('meta[name="csrf-token"]')?.content;const c=new URL(e,window.location.href);const a=c.origin===window.location.origin;fetch(e,{method:t,headers:{Accept:"text/vnd.turbo-stream.html,application/json,text/html",...!r&&t!=="GET"&&{"Content-Type":"application/json"},...a&&o?{"X-CSRF-Token":o}:{}},body:t==="GET"?null:r?s:JSON.stringify(s),credentials:a?"same-origin":"omit"}).then((e=>{const t=e.headers.get("content-type")||"";return t.includes("turbo-stream")?e.text().then((e=>({turbo:true,data:e}))):t.includes("json")?e.json():e.text()})).then((e=>e.turbo&&window.Turbo?Turbo.renderStreamMessage(e.data):d(e,n.target,n.loading?n.action.map((e=>e&&"replace")):n.action,n.template))).catch((e=>console.error("AJAX:",e.message)))};const p=(e,t)=>h(e,"GET",t);const[f,m,g,y]=["POST","PUT","PATCH","DELETE"].map((e=>(t,n,s)=>h(t,e,s,n)));const b={get(e,t,n){const s=Reflect.get(e,t,n);if(s&&typeof s==="object"){if(r.proxyCache.has(s))return r.proxyCache.get(s);const e=new Proxy(s,b);r.proxyCache.set(s,e);r.parentKeys.set(s,t);return e}return s},set:(e,t,n)=>{const s=Reflect.set(e,t,n);if(Array.isArray(e)&&!isNaN(t)){const t=r.parentKeys.get(e);t&&r.bindings.get(t)?.forEach(v)}r.bindings.get(t)?.concat(...r.bindings.get(o)??[])?.forEach(v);return s}};const w=new Proxy({},b);function v(t,n={},s=t.el){const{el:r,prop:o,fn:c,calc:a}=t;const i=c(l,w,n,s,u,p,f,m,g,y);a&&(w[a]=i);if(o==="innerHTML"){const e=Array.isArray(i)?i.join``:i;return typeof Idiomorph==="object"?Idiomorph.morph(r,e,{morphStyle:"innerHTML"}):r.innerHTML=e}if(o==="class"&&i&&typeof i==="object")return Object.entries(i).forEach((([e,t])=>e.split(/\s+/).forEach((e=>r.classList.toggle(e,t)))));if(o==="style"&&i&&typeof i==="object")return r.style.cssText=Object.entries(i).filter((([e,t])=>t!=null&&t!==false)).map((([e,t])=>`${e}:${t}`)).join("; ");o in r?r.type==="radio"&&o!="checked"?r.checked=r.value===i:r[o]=o==="textContent"?i:e(i):r.setAttribute(o,e(i))}const E=(e,t=false)=>{const n=`${t}:${e}`;if(r.fnCache.has(n))return r.fnCache.get(n);try{const s=new Function("$","$data","$event","$el","$html","$get","$post","$put","$patch","$delete",t?`with($data){return(${e.trim()})}`:`with($data){${e.trim()}}`);r.fnCache.set(n,s);return s}catch{return()=>e}};const $=(e,t,n=false)=>{const s=n?new Map:new Set;const o=new Proxy(w,{get(e,t){typeof t=="string"&&(n?!s.has(t)&&s.set(t,e[t]):s.add(t));const r=e[t];return typeof r=="object"&&r!=null?new Proxy(r,this):r}});try{e.call(null,l,o,r.refs)}catch{}return n?[...s.keys()].filter((e=>w[e]===s.get(e))):[...s]};const k=e=>{[e,...e.querySelectorAll("*")].forEach((e=>{r.listeners.get(e)?.forEach((({receiver:e,event:t,handler:n})=>e.removeEventListener(t,n)));r.listeners.delete(e)}))};async function T(i){const d=[];const b=[];const v=[i,...i.querySelectorAll("*")].filter((e=>{if(r.processed.has(e))return false;for(let t=0;t<e.attributes.length;t++)if(c.test(e.attributes[t].name))return true;return false}));const k=(e,t)=>{r.bindings.set(e,t.calc?[t,...r.bindings.get(e)||[]]:[...r.bindings.get(e)||[],t]);t.calc?d.unshift(t):d.push(t)};const T=[];v.forEach((e=>{const t=e.getAttribute("@import")||e.getAttribute("data-he-import");t&&t.split(",").map((e=>e.trim())).forEach((e=>{const t="helium_modules/"+e;T.push(import(t).then((e=>{Object.keys(e).forEach((t=>w[t]=e[t]))})).catch((t=>{console.error(`Failed to import module: ${e}`,t.message)})))}))}));T.length>0&&await Promise.all(T);v.forEach((o=>{r.processed.add(o);const c=o.attributes;const i=e=>E(e,true)(l,w,{},o,u,p,f,m,g,y);const d=o.type?.toLowerCase();const v=d=="checkbox",$=d=="radio",k=o.tagName=="SELECT";for(let d=0;d<c.length;d++){const{name:T,value:L}=c[d];if(T.startsWith("@")||T.startsWith(":")||T.startsWith("data-he")){if(a(T,"text","html","bind"))try{new Function(`let ${L}=1`);w[L]??=a(T,"bind")?o.type=="checkbox"?o.checked:o.value:o.textContent}catch{}if(T==="@data"||T==="data-he")Object.assign(w,e(L));else if(T.startsWith(":")||T.startsWith("data-he-attr:"))b.push({el:o,prop:T.slice(T.startsWith(":")?1:13),fn:E(L,true)});else if(a(T,"ref"))r.refs.set("$"+L,o);else if(a(T,"text","html"))b.push({el:o,prop:a(T,"text")?"textContent":"innerHTML",fn:E(L,true)});else if(a(T,"bind")){const e=v||$||k?"change":"input";const t=v?"checked":"value";const n=e=>w[L]=v?e.target.checked:e.target.value;o.addEventListener(e,n);r.listeners.has(o)||r.listeners.set(o,[]);r.listeners.get(o).push({receiver:o,event:e,handler:n});b.push({el:o,prop:t,fn:E(L,true)});v?o.checked=!!w[L]:$?o.checked=o.value==w[L]:o.value=w[L]??""}else if(a(T,"hidden","visible"))b.push({el:o,prop:"hidden",fn:E(`${a(T,"hidden")?"!":""}!(${L})`,true)});else if(a(T,"calculate"))b.push({el:o,calc:T.split(":")[1],prop:null,fn:E(L,true)});else if(a(T,"effect"))b.push({el:o,prop:null,fn:E(L,true),keys:T.split(":").slice(1)});else if(a(T,"init"))t=E(L,true);else if(T.startsWith("@")||T.startsWith("data-he")){const t=T.startsWith("@")?T.slice(1):T.slice(8);const[c,...a]=t.split(".");const d=["get","post","put","patch","delete"].includes(c);const b=d?n(o):c;const $=a.includes("outside")||a.includes("document")?document:o;const k=a.find((e=>e.startsWith("debounce")));const x=k?(e=>e&&!isNaN(e)?Number(e):300)(k.split(":")[1]):0;const C=t=>{const n=e=>E(e,true)(l,w,t,o,u,p,f,m,g,y);a.includes("prevent")&&t.preventDefault();const s={shift:"shiftKey",ctrl:"ctrlKey",alt:"altKey",meta:"metaKey"};for(const[e,n]of Object.entries(s))if(a.includes(e)&&!t[n])return;if(["keydown","keyup","keypress"].includes(b)){const e=a[a.length-1];if(e&&!["prevent","once","outside","document"].includes(e)){const n=t.key==" "?"Space":t.key=="Escape"?"Esc":t.key;if(n.toLowerCase()!==e.toLowerCase())return}}if(!a.includes("outside")||!o.contains(t.target))if(d){const t=e=>o.getAttribute(`data-he-${e}`)||o.getAttribute(`@${e}`);const s=(t("target")||"").split(",").map((e=>e.split(":").map((e=>e.trim()))));const r=s.map((([e])=>e));const a=s.map((([,e])=>e));const l={...t("options")&&e(t("options")||"{}"),...r&&{target:r},...a&&{action:a},...t("template")&&{template:i(t("template"))},...t("loading")&&{loading:i(t("loading"))}};let u=t("params");if(!u&&o.hasAttribute("name")){const e=o.getAttribute("name").match(/\w+/g).map((e=>`${e}:`)).join``;u=e+(v?"checked":"value")}else u||="{}";if(!u.trim().startsWith("{")&&u.includes(":")){const e=u.split(":").map((e=>e.trim()));u=e.reduceRight(((e,t,n)=>`{ ${t}: ${n==1?`'${o[e]}'`:e} }`))}const d=n(u);h(L,c.toUpperCase(),l,d)}else n(L);a.includes("once")&&$.removeEventListener(b,j)};const j=x>0?s(C,x):C;$.addEventListener(b,j);r.listeners.has(o)||r.listeners.set(o,[]);r.listeners.get(o).push({receiver:$,event:b,handler:j})}}}}));b.forEach((e=>{const t=e.keys?.includes("*")?[o]:$(e.fn,e.el,true).concat(e.keys);t.forEach((t=>k(t,e)))}));return d}r.observer=new MutationObserver((async e=>{for(const t of e){t.removedNodes.forEach((e=>e.nodeType===1&&k(e)));for(const e of t.addedNodes)if(e.nodeType===1&&!r.processed.has(e)){const t=await T(e);t?.forEach(v)}}}));r.observer.observe(i,{childList:true,subtree:true});const L=await T(i);L.forEach(v);t&&t(l,w,{},{},u,p,f,m,g,y)};window.heliumTeardown=function(){r?.observer&&r.observer.disconnect();r=null};document.addEventListener("DOMContentLoaded",(e=>helium()));document.addEventListener("turbo:before-render",(e=>window.heliumTeardown()));document.addEventListener("turbo:render",(e=>helium()));

